!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).OURO={})}(this,(function(e){"use strict";class t{}class s{constructor(e,t={}){this.creation=e,this.episodeList=t.episodeList?t.episodeList:[],this.index=0,this.activeEpisode=null,this.nextEpisode=null,this.lastEpisode=null}start(){this.activeEpisode=new this.episodeList[this.index](this.creation),this.startActiveEpisode()}pause(){}stop(){}iterateIndex(){return this.index+=1,this.index}setActiveEpisode(){this.lastEpisode=this.activeEpisode,this.activeEpisode=this.nextEpisode,this.nextEpisode=this.episodeList[this.iterateIndex()],this.creation.renderer.add,this.unloadLastEpisode()}loadNextEpisode(){this.nextEpisode=new this.nextEpisode(this.creation)}unloadLastEpisode(){this.lastEpisode.dispose(),this.lastEpisode=null}startActiveEpisode(){this.activeEpisode.start()}endActiveEpisode(){this.activeEpisode.stop()}render(){this.activeEpisode.render()}}class i{constructor(e,t={}){this.creation=e,this.sceneList=t.sceneList?t.sceneList:[],this.index=t.index?t.index:0,this.activeScene=null,this.lastScene=null,this.nextScene=null}iterateIndex(){return this.index+=1,this.index}iterateScene(){this.lastScene=this.activeScene,this.activeScene=this.nextScene,this.setNextScene(),this.iterateIndex(),this.unloadLastScene()}setNextScene(e=this.index+1){this.nextScene=this.sceneList[e]}loadNextScene(){this.nextScene&&(this.nextScene=new this.nextScene(this.creation))}unloadLastScene(){this.lastScene.dispose(),this.lastScene=null}startActiveScene(){this.activeScene.start()}endActiveScene(){this.activeScene.stop(),this.loadNextScene(),this.iterateScene()}start(){this.activeScene=new this.sceneList[this.index](this.creation),this.setNextScene()}render(){this.activeScene.render&&this.activeScene.render()}}class n{constructor(e,t={}){this.creation=e,this.mtl=t.mtl??null,this.geo=t.geo??null,this.mesh=t.mesh??new THREE.Mesh(this.geo,this.mtl),this.body=t.body??new CANNON.Body({mass:t.mass??1,shape:t.shape??null})}updatePosition(){this.mesh.position.copy(this.body.position),this.mesh.quaternion.copy(this.body.quaternion)}}class o{constructor(e){this.camera=e,this.forward=!1,this.left=!1,this.right=!1,this.backward=!1,this.jump=!1,this.canJump=!0,this.f=new THREE.Vector3,this.keypressed=null,this.keyreleased=null,this.mousemove=null,this.pointerLock=null,this.hasPointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,this.pointerlockchange=null,this.pointerlockerror=null,this.element=null,this.hasPointerLock&&(this.element=document.body,this.pointerLock=new THREE.PointerLockControls(this.camera,this.element),this.pointerlockchange=e=>{document.pointerLockElement===this.element||document.mozPointerLockElement===this.element||document.webkitPointerLockElement===this.element?this.pointerLock.enabled=!0:this.pointerLock.enabled=!1},this.pointerlockerror=function(e){},this.keyPressed=e=>{switch(e.keyCode){case 87:this.forward=!0;break;case 65:this.left=!0;break;case 83:this.backward=!0;break;case 68:this.right=!0;break;case 32:this.jump=!0}},this.keyReleased=e=>{switch(e.keyCode){case 87:this.forward=!1;break;case 65:this.left=!1;break;case 83:this.backward=!1;break;case 68:this.right=!1;break;case 32:this.jump=!1}},document.addEventListener("pointerlockchange",this.pointerlockchange,!1),document.addEventListener("mozpointerlockchange",this.pointerlockchange,!1),document.addEventListener("webkitpointerlockchange",this.pointerlockchange,!1),document.addEventListener("pointerlockerror",this.pointerlockerror,!1),document.addEventListener("mozpointerlockerror",this.pointerlockerror,!1),document.addEventListener("webkitpointerlockerror",this.pointerlockerror,!1),this.element.addEventListener("click",(e=>{this.element.requestPointerLock=this.element.requestPointerLock||this.element.mozRequestPointerLock||this.element.webkitRequestPointerLock,this.element.requestPointerLock()}),!1),window.addEventListener("keydown",this.keyPressed),window.addEventListener("keyup",this.keyReleased))}getForce(){return this.f.multiplyScalar(0),this.forward&&(this.f.z-=1),this.backward&&(this.f.z+=1),this.left&&(this.f.x-=1),this.right&&(this.f.x+=1),this.f.applyQuaternion(this.camera.quaternion),this.f.y=0,this.jump&&(this.f.y+=2),this.f}}e.BasicCube=class extends n{constructor(e,t={body:new CANNON.Body({shape:new CANNON.Box(new CANNON.Vec3(.5,.5,.5)),mass:4}),mesh:new THREE.Mesh(new THREE.BoxBufferGeometry(1,1,1),new THREE.MeshToonMaterial({color:5286128}))}){super(e,t),this.mesh.castShadow=!0,this.mesh.recieveShadow=!1}},e.BasicSphere=class extends n{constructor(e,t={body:new CANNON.Body({shape:new CANNON.Sphere(1),mass:4}),mesh:new THREE.Mesh(new THREE.SphereBufferGeometry(1),new THREE.MeshToonMaterial({color:5286128}))}){super(e,t),this.mesh.castShadow=!0,this.mesh.recieveShadow=!1}},e.Character=class extends n{constructor(e,t,s={body:new CANNON.Body({shape:new CANNON.Box(new CANNON.Vec3(.5,.5,.5)),mass:5}),mesh:new THREE.Object3D}){super(e,s),this.mesh.add(t),t.position.set(0,5,-3),this.speed=5e3,this.model=new THREE.Mesh(new THREE.BoxBufferGeometry(1,1,1),new THREE.MeshLambertMaterial({color:16777215})),this.mesh.add(this.model),this.controls=new o(t),this.vMagLine={geom:new THREE.Geometry,mat:new THREE.LineBasicMaterial({color:16711680}),m:null},this.vMagLine.geom.vertices.push(new THREE.Vector3,this.body.velocity),this.vMagLine.geom.verticesNeedUpdate=!0,this.vMagLine.m=new THREE.Line(this.vMagLine.geom,this.vMagLine.mat),this.vMagLine.m.position.setY(2),this.mesh.add(this.vMagLine.m)}updatePosition(){this.mesh.position.copy(this.body.position),this.model.quaternion.copy(this.body.quaternion)}update(){this.currSpeed=this.speed*this.creation.tickDelta,this.body.applyForce(this.controls.getForce().multiplyScalar(this.currSpeed),this.body.pointToWorldFrame(new CANNON.Vec3)),this.vMagLine.geom.verticesNeedUpdate=!0,this.updatePosition()}},e.Controls=o,e.Creation=class{constructor(e={}){this.canvas=e.canvasId?document.querySelector("#"+e.canvasId):document.body,this.renderer=new THREE.WebGLRenderer({canvas:this.canvas}),this.renderer.shadowMap.enabled=!e.shadowMapEnabled||e.shadowMapEnabled,this.renderer.shadowMap.enabled&&(this.renderer.shadowMap.type=THREE.BasicShadowMap),this.collmeshlist=[],this.clock=new THREE.Clock,this.tick=this.clock.getElapsedTime(),this.lastTick=this.tick,this.tickDelta=null,this.menuManager=e.menuManager?e.menuManager:new t(this),this.episodeManager=e.episodeManager?e.episodeManager:new s(this)}setMenuManager(e){this.menuManager=e}setEpisodeManager(e){this.episodeManager=e}tickUpdate(){this.tick=this.clock.getElapsedTime(),this.tickDelta=this.tick-this.lastTick,this.lastTick=this.tick}start(){this.episodeManager.start(),requestAnimationFrame((()=>this.render()))}render(){this.tickUpdate(),this.episodeManager.render(),window.requestAnimationFrame((()=>this.render()))}},e.Enemy=class extends n{constructor(e,t,s={body:new CANNON.Body({shape:new CANNON.Sphere(1),mass:5}),mesh:new THREE.Object3D}){super(e,s),this.mesh.add(t),t.position.set(0,5,-3),this.speed=5e3,this.model=new THREE.Mesh(new THREE.SphereBufferGeometry(1,10,10),new THREE.MeshLambertMaterial({color:16777215})),this.mesh.add(this.model),this.controls=new o(t),this.vMagLine={geom:new THREE.Geometry,mat:new THREE.LineBasicMaterial({color:16711680}),m:null},this.vMagLine.geom.vertices.push(new THREE.Vector3,this.body.velocity),this.vMagLine.geom.verticesNeedUpdate=!0,this.vMagLine.m=new THREE.Line(this.vMagLine.geom,this.vMagLine.mat),this.vMagLine.m.position.setY(2),this.mesh.add(this.vMagLine.m)}applyForce(e){this.a.add(e.divideScalar(this.body.mass))}updatePosition(){this.mesh.position.copy(this.body.position),this.model.quaternion.copy(this.body.quaternion)}update(){this.currSpeed=this.speed*this.creation.tickDelta,this.body.applyForce(this.controls.getForce().multiplyScalar(this.currSpeed),this.body.pointToWorldFrame(new CANNON.Vec3)),this.body.velocity,this.vMagLine.geom.verticesNeedUpdate=!0,this.updatePosition()}},e.EpisodeManager=s,e.EpisodeSkeleton=class{constructor(e,t={}){this.creation=e,this.name=t.name?t.name:"Episode",this.sceneManager=t.sceneManager?t.sceneManager:new i(this.creation)}nextScene(){this.sceneManager.loadNextScene(),this.sceneManager.iterateScene()}goToScene(e){this.sceneManager.index=e,this.sceneManager.setNextScene(e),this.nextScene()}start(){this.sceneManager.start()}stop(){this.sceneManager.stop()}render(){this.sceneManager.render()}},e.MenuManager=t,e.ObjectBase=n,e.SceneManager=i,e.SceneSkeleton=class{constructor(e,t={}){this.creation=e,this.scene=new THREE.Scene,this.scene.fog=new THREE.FogExp2(2105376,.025),this.camera=new THREE.PerspectiveCamera(90,this.creation.canvas.clientWidth/this.creation.canvas.clientHeight,.1,1e3),this.setAspect(),window.addEventListener("resize",(()=>{this.setAspect()}),!1),this.world=new CANNON.World,this.world.gravity.set(0,-9.82,0),this.world.broadphase=new CANNON.NaiveBroadphase,this.debugrenderer=new THREE.CannonDebugRenderer(this.scene,this.world)}add(e){this.scene.add(e.mesh),this.world.addBody(e.body)}start(){}end(){}update(){}setAspect(){this.camera.aspect=this.creation.canvas.clientWidth/this.creation.canvas.clientHeight,this.camera.updateProjectionMatrix(),this.creation.renderer.setSize(this.creation.canvas.clientWidth,this.creation.canvas.clientHeight)}render(){this.update(),this.world.step(1/60,this.creation.tickDelta,3),this.creation.renderer.render(this.scene,this.camera)}dispose(){this.scene=null,this.camera=null,this.render=null}},Object.defineProperty(e,"__esModule",{value:!0})}));
