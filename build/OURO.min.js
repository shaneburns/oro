!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).OURO={})}(this,(function(e){"use strict";class t{constructor(e,t={}){this.creation=e,this.target=t.target??null,this.forward=!1,this.left=!1,this.right=!1,this.backward=!1,this.jump=!1,this.canJump=t.canJump??!0,this.isJumping=!1,this.f=new THREE.Vector3}goForward(e){this.forward=e}goBackward(e){this.backward=e}goLeft(e){this.left=e}goRight(e){this.right=e}jumpUp(e){this.jump=e}applyDirection(){this.target?this.f.applyQuaternion(this.target.quaternion):console.log("no target to quatern")}applyJumpForce(){this.jump&&(!this.isJumping&&this.canJump&&(this.isJumping=!0,setTimeout((()=>{this.canJump=!1,setTimeout((()=>{this.canJump=!0,this.isJumping=!1}),1e3)}),200)),this.isJumping&&this.canJump&&(this.f.y+=5))}getForce(){return this.f.multiplyScalar(0),this.forward&&(this.f.z-=1),this.backward&&(this.f.z+=1),this.left&&(this.f.x-=1),this.right&&(this.f.x+=1),this.applyDirection(),this.f.y=0,this.applyJumpForce(),this.f}}class i{constructor(e,t={}){this.creation=e,this.loaded=!1,this.mtl=t.mtl??null,this.geo=t.geo??null,this.mesh=t.mesh??(null!==this.mtl&&null!==this.geo?new THREE.Mesh(this.geo,this.mtl):null),this.body=t.body??new CANNON.Body({mass:t.mass??1,shape:t.shape??null}),this.animations=t.animations??null,this.mixer=null}setMixer(){this.mixer=new THREE.AnimationMixer(this.mesh),this.animations.forEach((e=>{this.mixer.clipAction(e).play()})),this.mixer.setTime(60*Math.random()),this.loaded=!0}updatePosition(){this.mesh.position.copy(this.body.position),this.mesh.quaternion.copy(this.body.quaternion),this.loaded&&this.mixer.update(this.creation.tickDelta)}}class s extends YUKA.Goal{constructor(e){super(e),console.log("RestGoal constructing"),this.REST="REST",this.PLACEHOLDER="-"}activate(){console.log("RestGoal activated")}execute(){const e=this.owner;console.log("RestGoal executing"),e.currentTime+=e.deltaTime,console.log("current time = "+e.currentTime),console.log("rest duration = "+e.restDuration),e.currentTime>=e.restDuration&&(this.status=YUKA.Goal.STATUS.COMPLETED,console.log("REST GOAL COMPLETED = "+this.status)),console.log("RestGoal executed")}terminate(){const e=this.owner;e.currentTime=0,e.fatigueLevel=0}}class o extends YUKA.GoalEvaluator{calculateDesirability(e){return console.log("calculating Rest desirability "),console.log("rest desireability = bee.tired = "+e.tired()),!0===e.tired()?1:0}setGoal(e){const t=e.brain.currentSubgoal();console.log("setting rest Goal"),t instanceof s==!1&&(e.brain.clearSubgoals(),e.brain.addSubgoal(new s(e)),console.log("subgoals cleared and new subgoal = restGoal"))}}class n extends YUKA.CompositeGoal{constructor(e){super(e),this.GATHER="GATHER",this.localPosition=new YUKA.Vector3}activate(){console.log("INVERSEmat"),this.addSubgoal(new a(this.owner)),this.addSubgoal(new r(this.owner)),this.addSubgoal(new c(this.owner))}execute(){this.status=this.executeSubgoals(),this.replanIfFailed()}}class a extends YUKA.Goal{constructor(e){super(e),this.FIND_NEXT="FIND NEXT",console.log("INVERSEmatty"),this.inverseMatrix=new YUKA.Matrix4,console.log(new YUKA.Matrix4),console.log("///////////////////////"),this.localPosition=new YUKA.Vector3,this.animationId=null,console.log("Owner Constructor"),console.log(this.owner)}activate(){const e=this.owner;console.log("Owner Activation"),console.log(e);const t=e.manager.entities;let i=1/0;for(let s=0,o=t.length;s<o;s++){const o=t[s];if(o!==e){const t=e.position.squaredDistanceTo(o.position);t<i&&(i=t,e.currentTarget=o)}}e.updateWorldMatrix(),e.worldMatrix.getInverse(this.inverseMatrix),this.localPosition.copy(e.currentTarget.position).applyMatrix4(this.inverseMatrix),console.log("Owner Activation ended")}execute(){const e=this.owner;console.log("Find Next Collectible Executing..."),null!==e.currentTarget?!0===e.rotateTo(e.currentTarget.position,e.deltaTime)&&(this.status=YUKA.Goal.STATUS.COMPLETED):this.status=YUKA.Goal.STATUS.FAILED,console.log("Find Next Collectible Executed")}terminate(){this.owner;console.log("Find Next Collectible Terminated")}}class r extends YUKA.Goal{constructor(e){super(e),console.log("Seek To Collectible Goal constructing"),this.SEEK="SEEK",this.PICK_UP="PICK UP",this.PLACEHOLDER="-",this.WALK="WALK",this.RIGHT_TURN="RIGHT_TURN",this.LEFT_TURN="LEFT_TURN",this.IDLE="IDLE",this.inverseMatrix=new YUKA.Matrix4,this.localPosition=new YUKA.Vector3}activate(){const e=this.owner;if(console.log("seeking collectible activating"),null!==e.currentTarget){const t=e.steering.behaviors[0];t.target=e.currentTarget.position,t.active=!0}else this.status=YUKA.Goal.STATUS.FAILED;console.log("seeking collectible activated")}execute(){if(console.log("seeking collectible executing"),this.active()){const e=this.owner;e.position.squaredDistanceTo(e.currentTarget.position)<.25&&(this.status=YUKA.Goal.STATUS.COMPLETED)}console.log("seeking collectible executed")}terminate(){console.log("seeking collectible terminating");this.owner.steering.behaviors[0].active=!1,this.owner.velocity.set(0,0,0);this.owner;console.log("seeking collectible terminated")}}class c extends YUKA.Goal{constructor(e){super(e),console.log("Picking up collectible goal constructing"),this.REST="REST",this.GATHER="GATHER",this.FIND_NEXT="FIND NEXT",this.SEEK="SEEK",this.PICK_UP="PICK UP",this.PLACEHOLDER="-",this.WALK="WALK",this.RIGHT_TURN="RIGHT_TURN",this.LEFT_TURN="LEFT_TURN",this.IDLE="IDLE",this.inverseMatrix=new YUKA.Matrix4,this.localPosition=new YUKA.Vector3,this.collectibleRemoveTimeout=3}activate(){this.owner;console.log("Picking up collectible goal activating"),console.log("Picking up collectible goal activated")}execute(){const e=this.owner;console.log("Picking up collectible goal executing"),e.currentTime+=e.deltaTime,console.log("current time = "+e.currentTime),console.log("pickupDuration = "+e.pickUpDuration),e.currentTime>=e.pickUpDuration?this.status=YUKA.Goal.STATUS.COMPLETED:e.currentTime>=this.collectibleRemoveTimeout&&null!==e.currentTarget&&(e.sendMessage(e.currentTarget,"PickedUp"),e.currentTarget=null),console.log("Picking up collectible goal executed")}terminate(){const e=this.owner;console.log("Picking up collectible goal terminating"),e.currentTime=0,e.fatigueLevel++,console.log("Picking up collectible goal terminated")}}class l extends YUKA.GoalEvaluator{calculateDesirability(){return console.log("gathergoal desirability = 0.5"),.5}setGoal(e){const t=e.brain.currentSubgoal();console.log("gatherGoal setting in gather evaluator"),t instanceof n==!1&&(e.brain.clearSubgoals(),console.log("clearing subgoals since current subgoal is false"),e.brain.addSubgoal(new n(e)),console.log("new gathergoal added to subgoal"))}}class h extends YUKA.Vehicle{constructor(e){super(),this.maxTurnRate=.5*Math.PI,this.maxSpeed=1.5,this.mixer=e,this.ui={},this.brain=new YUKA.Think(this),this.brain.addEvaluator(new o),this.brain.addEvaluator(new l);const t=new YUKA.ArriveBehavior;t.deceleration=1.5,this.steering.add(t),this.fatigueLevel=0,this.restDuration=5,this.pickUpDuration=6,this.crossFadeDuration=.5,this.currentTarget=null,this.currentTime=0,this.deltaTime=0,this.MAX_FATIGUE=3,console.log(this),console.log(1)}update(e){super.update(e),this.deltaTime=e,this.brain.execute(),this.brain.arbitrate()}tired(){return this.fatigueLevel>=this.MAX_FATIGUE}}class d extends t{constructor(e,t,i){super(e),this.camera=t,this.target=i,this.keypressed=null,this.keyreleased=null,this.mousemove=null,this.pointerLock=null,this.hasPointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,this.pointerlockchange=null,this.pointerlockerror=null,this.element=null,this.hasPointerLock&&(this.element=document.body,this.pointerLock=new THREE.PointerLockOrbitControls(this.camera,this.target,this.creation.tickDelta,this.element),this.pointerlockchange=e=>{document.pointerLockElement===this.element||document.mozPointerLockElement===this.element||document.webkitPointerLockElement===this.element?this.pointerLock.enabled=!0:this.pointerLock.enabled=!1},this.pointerlockerror=function(e){},this.keyPressed=e=>{switch(e.keyCode){case 87:this.goForward(!0);break;case 65:this.goLeft(!0);break;case 83:this.goBackward(!0);break;case 68:this.goRight(!0);break;case 32:this.jumpUp(!0)}},this.keyReleased=e=>{switch(e.keyCode){case 87:this.goForward(!1);break;case 65:this.goLeft(!1);break;case 83:this.goBackward(!1);break;case 68:this.goRight(!1);break;case 32:this.jumpUp(!1)}},document.addEventListener("pointerlockchange",this.pointerlockchange,!1),document.addEventListener("mozpointerlockchange",this.pointerlockchange,!1),document.addEventListener("webkitpointerlockchange",this.pointerlockchange,!1),document.addEventListener("pointerlockerror",this.pointerlockerror,!1),document.addEventListener("mozpointerlockerror",this.pointerlockerror,!1),document.addEventListener("webkitpointerlockerror",this.pointerlockerror,!1),this.element.addEventListener("click",(e=>{this.element.requestPointerLock=this.element.requestPointerLock||this.element.mozRequestPointerLock||this.element.webkitRequestPointerLock,this.element.requestPointerLock()}),!1),window.addEventListener("keydown",this.keyPressed),window.addEventListener("keyup",this.keyReleased))}applyDirection(){this.f.applyQuaternion(this.camera.quaternion)}update(){this.pointerLock.updateTimeElapsed(this.creation.tickDelta),this.pointerLock.update()}}class u{}class p{constructor(e,t={}){this.creation=e,this.episodeList=t.episodeList?t.episodeList:[],this.index=0,this.activeEpisode=null,this.nextEpisode=null,this.lastEpisode=null}start(){this.activeEpisode=new this.episodeList[this.index](this.creation),this.startActiveEpisode()}pause(){}stop(){}iterateIndex(){return this.index+=1,this.index}setActiveEpisode(){this.lastEpisode=this.activeEpisode,this.activeEpisode=this.nextEpisode,this.nextEpisode=this.episodeList[this.iterateIndex()],this.creation.renderer.add,this.unloadLastEpisode()}loadNextEpisode(){this.nextEpisode=new this.nextEpisode(this.creation)}unloadLastEpisode(){this.lastEpisode.dispose(),this.lastEpisode=null}startActiveEpisode(){this.activeEpisode.start()}endActiveEpisode(){this.activeEpisode.stop()}render(){this.activeEpisode.render()}}class m extends YUKA.GameEntity{spawn(){this.position.x=15*Math.random()-7.5,this.position.z=15*Math.random()-7.5,this.position.x<1&&this.position.x>-1&&(this.position.x+=1),this.position.z<1&&this.position.y>-1&&(this.position.z+=1)}handleMessage(e){switch(e.message){case"PickedUp":return this.spawn(),!0;default:console.warn("Collectible: Unknown message.")}return!1}}class g extends i{constructor(e,t){t.texture=e.texLoader.load(t.texture?t.texture:"./../assets/textures/explosion.png"),t.complexity=t.detail??4,t.timeScale=t.timeScale??.025,t.turbScale=19,t.coreMat=new THREE.ShaderMaterial({uniforms:{tExplosion:{type:"t",value:t.texture},time:{type:"f",value:0},turbScale:{type:"f",value:t.turbScale}},vertexShader:coreVShader(),fragmentShader:coreFShader()}),t.body=new CANNON.Body({shape:new CANNON.Sphere(1),mass:4}),t.model=new THREE.Mesh(new THREE.IcosahedronBufferGeometry(.9,t.complexity),t.coreMat),t.mesh=new THREE.Object3D,super(e,t),this.model=t.model,this.mesh.add(this.model),this.model.position.x=.35,this.texture=t.texture.dispose(),this.complexity=t.complexity,this.timeScale=t.timeScale,this.turbScale=t.turbScale,this.coreMat=t.coreMat}updateTime(e){this.coreMat.uniforms.time.value=e}updateTimeScale(e){this.timeScale=e}updateTexture(e){this.coreMat.uniforms.tExplosion.value=this.texture=mg.tex.load(e)}updateTurbScale(e){this.coreMat.uniforms.turbScale.value=this.turbScale=e}update(){this.updateTime(this.creation.tick*this.timeScale)}}class E{constructor(e,t={}){this.creation=e,this.sceneList=t.sceneList?t.sceneList:[],this.index=t.index?t.index:0,this.activeScene=null,this.lastScene=null,this.nextScene=null}iterateIndex(){return this.index+=1,this.index}iterateScene(){this.lastScene=this.activeScene,this.activeScene=this.nextScene,this.setNextScene(),this.iterateIndex(),this.unloadLastScene()}setNextScene(e=this.index+1){this.nextScene=this.sceneList[e]}loadNextScene(){this.nextScene&&(this.nextScene=new this.nextScene(this.creation))}unloadLastScene(){this.lastScene.dispose(),this.lastScene=null}startActiveScene(){this.activeScene.start()}endActiveScene(){this.activeScene.stop(),this.loadNextScene(),this.iterateScene()}start(){this.activeScene=new this.sceneList[this.index](this.creation),this.setNextScene()}render(){this.activeScene.render&&this.activeScene.render()}}class w{constructor(e,t={}){this.creation=e,this.scene=new THREE.Scene,this.scene.fog=new THREE.FogExp2(2105376,.025),this.camera=new THREE.PerspectiveCamera(55,this.creation.canvas.clientWidth/this.creation.canvas.clientHeight,.1,1e3),this.setAspect(),window.addEventListener("resize",(()=>{this.setAspect()}),!1),this.map=new THREE.Object3D,this.scene.add(this.map),this.world=new CANNON.World,this.world.gravity.set(0,-9.82,0),this.world.broadphase=new CANNON.NaiveBroadphase,this.debugrenderer=new THREE.CannonDebugRenderer(this.scene,this.world)}add(e){this.scene.add(e.mesh),this.world.addBody(e.body)}start(){}end(){}update(){}setAspect(){this.camera.aspect=this.creation.canvas.clientWidth/this.creation.canvas.clientHeight,this.camera.updateProjectionMatrix(),this.creation.renderer.setSize(this.creation.canvas.clientWidth,this.creation.canvas.clientHeight)}render(){this.update(),this.world.step(1/60,this.creation.tickDelta,3),this.creation.renderer.render(this.scene,this.camera)}dispose(){this.scene=null,this.camera=null,this.render=null}}e.BaseControls=t,e.BasicCube=class extends i{constructor(e,t={body:new CANNON.Body({shape:new CANNON.Box(new CANNON.Vec3(.5,.5,.5)),mass:4}),mesh:new THREE.Mesh(new THREE.BoxBufferGeometry(1,1,1),new THREE.MeshToonMaterial({color:5286128}))}){super(e,t)}},e.BasicSphere=class extends i{constructor(e,t={body:new CANNON.Body({shape:new CANNON.Sphere(1),mass:4}),mesh:new THREE.Mesh(new THREE.SphereBufferGeometry(1,64,64),new THREE.MeshToonMaterial({color:5286128}))}){super(e,t),this.mesh.castShadow=!0,this.mesh.recieveShadow=!1}},e.BasicTorus=class extends i{constructor(e,t={body:new CANNON.Body({shape:CANNON.Trimesh.createTorus(5,1,16,16),mass:1}),mesh:new THREE.Mesh(new THREE.TorusBufferGeometry(5,1,16,16),new THREE.MeshToonMaterial({color:5286128}))}){super(e,t)}},e.Bee=h,e.Character=class extends i{constructor(e,t,i={body:new CANNON.Body({shape:new CANNON.Box(new CANNON.Vec3(.5,.5,.5)),mass:5}),mesh:new THREE.Object3D}){super(e,i),this.mesh.add(t),t.position.set(0,5,-3),this.speed=20,this.model=new THREE.Mesh(new THREE.BoxBufferGeometry(1,1,1),new THREE.MeshLambertMaterial({color:16777215})),this.mesh.add(this.model),this.controls=new d(t),this.vMagLine={geom:new THREE.Geometry,mat:new THREE.LineBasicMaterial({color:16711680}),m:null},this.vMagLine.geom.vertices.push(new THREE.Vector3,this.body.velocity),this.vMagLine.geom.verticesNeedUpdate=!0,this.vMagLine.m=new THREE.Line(this.vMagLine.geom,this.vMagLine.mat),this.vMagLine.m.position.setY(2),this.mesh.add(this.vMagLine.m)}updatePosition(){this.mesh.position.copy(this.body.position),this.model.quaternion.copy(this.body.quaternion)}update(){this.currSpeed=this.speed-Math.pow(.001,this.creation.tickDelta),this.body.applyForce(this.controls.getForce().multiplyScalar(this.currSpeed),this.body.pointToWorldFrame(new CANNON.Vec3)),this.vMagLine.geom.verticesNeedUpdate=!0,this.updatePosition()}},e.Collectible=m,e.Controls=d,e.CoreSphere=g,e.Creation=class{constructor(e={}){this.canvas=e.canvasId?document.querySelector("#"+e.canvasId):document.body,this.renderer=new THREE.WebGLRenderer({canvas:this.canvas}),this.renderer.shadowMap.enabled=!e.shadowMapEnabled||e.shadowMapEnabled,this.renderer.shadowMap.enabled&&(this.renderer.shadowMap.type=THREE.PCFShadowMap),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.toneMapping=THREE.ACESFilmicToneMapping,this.renderer.toneMappingExposure=1,this.renderer.outputEncoding=THREE.sRGBEncoding,this.mtlLoader=new THREE.MTLLoader,this.objLoader=new THREE.OBJLoader,this.texLoader=new THREE.TextureLoader,this.collmeshlist=[],this.clock=new THREE.Clock,this.tick=this.clock.getElapsedTime(),this.lastTick=this.tick,this.tickDelta=null,this.menuManager=e.menuManager?e.menuManager:new u(this),this.episodeManager=e.episodeManager?e.episodeManager:new p(this)}setMenuManager(e){this.menuManager=e}setEpisodeManager(e){this.episodeManager=e}tickUpdate(){this.tick=this.clock.getElapsedTime(),this.tickDelta=this.tick-this.lastTick,this.lastTick=this.tick}start(){this.episodeManager.start(),requestAnimationFrame((()=>this.render()))}render(){this.tickUpdate(),this.episodeManager.render(),window.requestAnimationFrame((()=>this.render()))}},e.Enemy=class extends i{constructor(e,t,i={mesh:new THREE.Object3D}){i.model=new g(e,{texture:"./node_modules/ouro-engine/src/assets/textures/explosion.png",detail:16}),i.body=i.model.body,super(e,i),this.model=i.model,this.mesh.add(this.model.mesh),this.speed=30,this.controls=new d(e,t,this.model.mesh),this.vMagLine={geom:new THREE.Geometry,mat:new THREE.LineBasicMaterial({color:16711680}),m:null},this.vMagLine.geom.vertices.push(new THREE.Vector3,this.body.velocity),this.vMagLine.geom.verticesNeedUpdate=!0,this.vMagLine.m=new THREE.Line(this.vMagLine.geom,this.vMagLine.mat),this.vMagLine.m.position.setY(2),this.mesh.add(this.vMagLine.m)}applyForce(e){this.a.add(e.divideScalar(this.body.mass))}updatePosition(){this.mesh.position.copy(this.body.position),this.model.mesh.quaternion.copy(this.body.quaternion)}update(){this.currSpeed=this.speed-Math.pow(.001,this.creation.tickDelta),this.controls.update(),this.body.applyForce(this.controls.getForce().multiplyScalar(this.currSpeed),this.body.pointToWorldFrame(new CANNON.Vec3)),this.model.update(),this.vMagLine.geom.verticesNeedUpdate=!0,this.updatePosition()}},e.EpisodeManager=p,e.EpisodeSkeleton=class{constructor(e,t={}){this.creation=e,this.name=t.name?t.name:"Episode",this.sceneManager=t.sceneManager?t.sceneManager:new E(this.creation)}nextScene(){this.sceneManager.loadNextScene(),this.sceneManager.iterateScene()}goToScene(e){this.sceneManager.index=e,this.sceneManager.setNextScene(e),this.nextScene()}start(){this.sceneManager.start()}stop(){this.sceneManager.stop()}render(){this.sceneManager.render()}},e.FindNextCollectibleGoal=a,e.GatherEvaluator=l,e.GatherGoal=n,e.MenuManager=u,e.ObjectBase=i,e.PickUpCollectibleGoal=c,e.PlayableScene=class extends w{constructor(e,t){super(e,t),this.player=null}update(){let e=1-Math.pow(.001,this.creation.tickDelta),t=this.player.body.position.clone();t=t.scale(-1),this.scene.position.lerp(new THREE.Vector3(t.x,t.y,t.z),e)}},e.RestEvaluator=o,e.RestGoal=s,e.SceneManager=E,e.SceneSkeleton=w,e.SeekToCollectibleGoal=r,e.Utils=class{static getCenterPoint(e){let t=e.geometry;t.computeBoundingBox(),console.log(t);let i=t.boundingBox.getCenter(new THREE.Vector3);return console.log(i),e.localToWorld(i),console.log(i),i}},Object.defineProperty(e,"__esModule",{value:!0})}));
